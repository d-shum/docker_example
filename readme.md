Проект состоит из двух частей 
# Фронтенд в front 
 image докера с двух этапной сборкой сначала  билдится фронтовой проект, потом результаты билда копируются в image nginx. Так же копируется кастомный конфиг нжиникса необходимый для проксирования запросов к контейнеру бека.  
# Бакенд back 
 image докера на основе node, внутри простейший сервер возвращаю количество обращений к нему с момента запуска.
 
# Запуск локально
Все команды внутри docker_example.

* Запускается  проект по средствам
`docker-compose up –d`
`docker-compose` автоматом собирает  image описаные в docker-compose.yml на основе Dockerfile лежащих в папках front/back
При переходе на <http://localhost/> отобразится фронт

* Проверить статус контейнеров можно командой docker ps.
Для того чтобы остановить контейнеры, нужно там же выполнить  docker-compose down

# Деплой

Тут мы деплоим в кластер состоящий из одной машины.

* создаем машину `docker-machine create target_machine` она  будет единственным node нашего кластера, являсь и manager и worker одновременно.

* нужно создать swarm(режим распределенной работы) на целевой машине для этого переейти в машину `docker-machine ssh target_machine` и выполнить `swarm init` после этого станут доступны `docker stack` и `docker service` предназанченные для работы с распределенными контейнерами Опционально включить в него столько сколько нужно машин docker swarm join --token xxx

* Создаем registry образов на нашей машине  docker service create --name registry --publish published=5000,target=5000 registry:2

* выходим из машины exit

* на локальной машине Добавляем в исключения докера наш registry где xx.xx.xx.xx:5000 айпи адрес и порт. Для линукса создаем 
/etc/docker/daemon.json и добавляем  `{"insecure-registries":["xx.xx.xx.xx:5000"]}`  у винды есть GUI. Ip машины узнать можно через `docker-machine ip target_machine` 

* docker-compose push пушим образы затрагиваемые compose фаилом в registry на целевую машину

* Для того чтобы проводить команды докера на целевой машине но иметь доступ к лоакльной фаиловой системе где лежит наш фаил docker compose переключаемся на докер целевой машины. Команда  `docker-machine env target_machine` покажет как установиьт переменные докера на ОС вашей машины. Для линукса эта команда выглядет так `eval $(docker-machine env target_machine)` 

* Непосредственно деплой осуществляется командой `docker stack deploy -c docker-compose.yml service_name`. Для редеплоя нужно использовать команду  `docker stack update -c docker-compose.yml service_name`
 
* Чтобы вернутся к локальному докеру необходимо вписать `docker-machine env -u` и выполнить предложенную команду.
* При переходе на <http://ip-машины/> отобразится фронт

# Выжимка докера

В докере два режима работы которые мы назовем standalone( на конретной докер машине) и swarm кластер из машин  контейнеры распределены по куче машин 

## Standalone

команды выполняются на конкретной машине с докером
* docker run для запуска контейнера из образа
* docker build для сборки из докерфаила
* docker image работа с образами
* docker ps  список запущенных контейнеров
* docker-compose для запуска группы контейнеров локально через docker-compose.yml

## Swarm
#### Команды на локальной машине
* Docker-machine  для связи с другими машинами
#### Команды выполняются на кластере 
* Docker stack  для деплоя группы сервисов docker-compose.yml
* Docker service для управления отдельными сервисами или деплоя
* Docker node для управления состоянием машин кластера
* Docker swarm  для  создания/манипуляций swarm


# Основы докера на примере фронта

Контейнер <== Образ <== Dockerfile

### Простейший хелловорлдец 
* `docker run –p 80:80  nginx`

запускает контейнер являющийся экземпляром образа с тегом nginx, -p  пробрасывает порт контейнера хосту. На хосте nginx будет доступен по локалхосту.
  
### Минимальный докерфаил

Dockerfile формат описывающий создание образов
Минимально полезный Dockerfile
```
FROM nginx
COPY build /usr/share/nginx.htm
```

За основу берем nginx.
копируем из локальную папку build в папку внутри контейнера из которой nginx раздает index.html
`docker build . -t foo` создаем образ с тегом foo
`docker run -p 80:80 foo` запускаем образ
